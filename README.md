# Primitive database

Это - минималистичная файловая СУБД с управлением схемой, CRUD-операциями, хранением данных в JSON и консольным выводом через PrettyTable.

## Возможности
- Управление схемой: create_table, list_tables, drop_table; столбец ID:int добавляется автоматически.
- CRUD-операции: insert, select (с where), update (set + where), delete (с where), info.
- Хранение данных: метаданные в db_meta.json, каждая таблица в отдельном файле data/<table>.json.
- Строгие типы: доступны только int, str, bool; все поля обязательны кроме авто-ID.
- Простой парсинг условий: строки обязательно в кавычках; where/set в формате column = value, несколько присваиваний через запятую.
- Красивый вывод select с заголовками и строками через PrettyTable.

## Структура проекта
- db_meta.json — метаданные схемы (список таблиц и их столбцы).
- data/ — JSON-файлы с записями по каждой таблице (например, data/users.json).
- src/
  - decorators.py — декораторы handle_db_errors, confirm_action, log_time и простой кэшер create_cacher.
  - primitive_db/
    - utils.py — загрузка/сохранение метаданных и данных таблиц, авто-создание data/.
    - core.py — операции с таблицами и данными, валидация типов данных, автогенерация ID.
    - parser.py — разбор команд insert/select/update/delete/info и where/set.
    - engine.py — интерактивный цикл, PrettyTable-вывод, интеграция CRUD.
    - main.py — точка входа.

## Установка
- Требуется Python 3.x 
- Клонируйте репозиторий или скопируйте файлы проекта в локальную директорию.

## Быстрый старт
- Команда в консоли: `make project`
- В интерактивной консоли доступны команды help и exit.

Пример сессии:
```
user@pc-name:~/Documents/primitive_db$ make project
>>> create_table users name:str age:int is_active:bool
>>> insert into users values ("Sergei", 28, true)
>>> select from users where age = 28
>>> update users set age = 29 where name = "Sergei"
>>> delete from users where ID = 1
>>> info users
>>> list_tables
>>> help
>>> exit
```

## Команды
- create_table <имя> <столбец1:тип> <столбец2:тип> ... — создаёт таблицу; ID:int добавляется автоматически.
- list_tables — показывает имена всех таблиц.
- drop_table <имя> — удаляет таблицу из метаданных (файл данных можно удалить вручную при необходимости).
- insert into <имя> values (v1, v2, ...) — добавляет запись без ID; число значений = числу столбцов минус ID.
- select from <имя> [where col = value] — выводит все записи или только подходящие по условию.
- update <имя> set col1 = value1[, col2 = value2 ...] where col = value — обновляет поля у подходящих записей.
- delete from <имя> where col = value — удаляет подходящие записи.
- info <имя> — печатает схему и количество строк.
- help — краткая справка по всем командам.
- exit — выход из программы.

## Правила типов и парсинга
- Допустимые типы столбцов: int, str, bool.
- Строки указывайте в кавычках: "Alice" или 'Alice'; числа без кавычек: 42; логические: true/false.
- В insert нельзя передавать значение для ID; он генерируется автоматически на основе существующих записей.
- Все пользовательские поля обязательны; количество значений в insert должно точно совпадать со схемой (без ID).
- where и set поддерживают формат col = value, несколько присваиваний разделяются запятыми в set.

## Хранение данных
- Метаданные схемы: db_meta.json в корне проекта.
- Данные: JSON по таблицам, путь data/<table>.json; директория data создаётся автоматически при первом сохранении.
- Формат записи: объект со всеми полями, включая ID (например, {"ID": 1, "name": "Sergei", "age": 28, "is_active": true}).

## Примеры
- Создание таблицы:
  - create_table users name:str age:int is_active:bool.
- Вставка строки:
  - insert into users values ("Sergei", 28, true).
- Чтение с фильтром:
  - select from users where age = 28.
- Обновление:
  - update users set age = 29 where name = "Sergei".
- Удаление:
  - delete from users where ID = 1.
- Информация:
  - info users (печатает схему и количество записей).

## Вывод таблиц
- Результаты select печатаются с заголовками столбцов и строками данных через библиотеку PrettyTable.

## Подтверждения и обработка ошибок
- Перед удалением таблицы и удалением записей запрашивается подтверждение через confirm_action.  
- handle_db_errors перехватывает распространённые ошибки (например, отсутствующие таблицы или некорректные типы) и возвращает безопасные значения, не падая целиком.

## Кэширование и производительность
- SELECT кэшируется по ключу (имя таблицы + условие where); кэш автоматически сбрасывается после модификаций данных и удаления таблицы.  
- log_time печатает время выполнения insert и select, помогая заметить ускорение повторных запросов.

## Правила типов и парсинга
- Разрешённые типы: int, str, bool; строки — в кавычках, числа — без кавычек, логические — true/false.
- ID генерируется автоматически и недоступен для изменения в update.

## Известные ограничения
- Нет сложных условий (AND/OR), только одно равенство в where.
- Нет индексов и транзакций; хранение — в JSON без блокировок.